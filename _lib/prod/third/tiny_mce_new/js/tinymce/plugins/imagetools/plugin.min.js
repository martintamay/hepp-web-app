!function(t,e){"use strict";function n(t,e){for(var n,o=[],a=0;a<t.length;++a){if(n=c[t[a]]||i(t[a]),!n)throw"module definition dependecy not found: "+t[a];o.push(n)}e.apply(null,o)}function o(t,o,i){if("string"!=typeof t)throw"invalid module definition, module id must be defined and be a string";if(o===e)throw"invalid module definition, dependencies must be specified";if(i===e)throw"invalid module definition, definition function must be specified";n(o,function(){c[t]=i.apply(null,arguments)})}function i(e){for(var n=t,o=e.split(/[.\/]/),i=0;i<o.length;++i){if(!n[o[i]])return;n=n[o[i]]}return n}function a(n){for(var o=0;o<n.length;o++){for(var i=t,a=n[o],r=a.split(/[.\/]/),u=0;u<r.length-1;++u)i[r[u]]===e&&(i[r[u]]={}),i=i[r[u]];i[r[r.length-1]]=c[a]}}var r,c={};o("tinymce/imagetoolsplugin/Canvas",[],function(){function t(t,e){return n(document.createElement("canvas"),t,e)}function e(t){return t.getContext("2d")}function n(t,e,n){return t.width=e,t.height=n,t}return{create:t,resize:n,get2dContext:e}}),o("tinymce/imagetoolsplugin/Mime",[],function(){function t(t){var e=document.createElement("a");return e.href=t,e.pathname}function e(e){var n=t(e).split("."),o=n[n.length-1],i={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return o&&(o=o.toLowerCase()),i[o]}return{guessMimeType:e}}),o("tinymce/imagetoolsplugin/ImageSize",[],function(){function t(t){return t.naturalWidth||t.width}function e(t){return t.naturalHeight||t.height}return{getWidth:t,getHeight:e}}),o("tinymce/imagetoolsplugin/Conversions",["tinymce/util/Promise","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize"],function(t,e,n,o){function i(e){return r=$(e).attr("src"),new t(function(t){function n(){e.removeEventListener("load",n),t(e)}e.complete?t(e):e.addEventListener("load",n)})}function a(t){return i(t).then(function(t){var n,i;return i=e.create(o.getWidth(t),o.getHeight(t)),n=e.get2dContext(i),n.drawImage(t,0,0),i})}function c(t){return i(t).then(function(t){var e=t.src;return 0===e.indexOf("blob:")?l(e):0===e.indexOf("data:")?s(e):a(t).then(function(t){return s(t.toDataURL(n.guessMimeType(e)))})})}function u(e){return new t(function(t){function n(){o.removeEventListener("load",n),t(o)}var o=new Image;o.addEventListener("load",n),o.src=URL.createObjectURL(e),o.complete&&n()})}function l(e){return new t(function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){200==this.status&&t(this.response)},n.send()})}function s(e){return new t(function(t){var n,o,i,a,r,c;if(e=e.split(","),a=/data:([^;]+)/.exec(e[0]),a&&(r=a[1]),n=atob(e[1]),window.WebKitBlobBuilder){for(c=new WebKitBlobBuilder,o=new ArrayBuffer(n.length),i=0;i<o.length;i++)o[i]=n.charCodeAt(i);return c.append(o),void t(c.getBlob(r))}for(o=new Uint8Array(n.length),i=0;i<o.length;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:r}))})}function d(t){return 0===t.indexOf("blob:")?l(t):0===t.indexOf("data:")?s(t):null}function m(t,e){return s(t.toDataURL(e))}function g(e){return new t(function(t){var n=new FileReader;n.onloadend=function(){$.ajax({type:"POST",async:!1,url:nm_url_iface+"help_case_file_manager.php",data:{ajax:"nm",option:"save_imagetools_edit",img_data:n.result,img_path:r},success:function(t){console.log(t)},error:function(t,e,n){return alert(n),!1}}),t(n.result)},n.readAsDataURL(e)})}function f(t){return g(t).then(function(t){return t.split(",")[1]})}function h(t){URL.revokeObjectURL(t.src)}return{blobToImage:u,imageToBlob:c,uriToBlob:d,blobToDataUri:g,blobToBase64:f,imageToCanvas:a,canvasToBlob:m,revokeImageUrl:h}}),o("tinymce/imagetoolsplugin/ImageTools",["tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize"],function(t,e,n){function o(o,i){return t.blobToImage(o).then(function(a){var r=e.create(n.getWidth(a),n.getHeight(a)),u=e.get2dContext(r),l=0,s=0;return i=0>i?360+i:i,(90==i||270==i)&&e.resize(r,r.height,r.width),(90==i||180==i)&&(l=r.width),(270==i||180==i)&&(s=r.height),u.translate(l,s),u.rotate(i*Math.PI/180),u.drawImage(a,0,0),c(a),t.canvasToBlob(r,o.type)})}function i(o,i){return t.blobToImage(o).then(function(o){var a=e.create(n.getWidth(o),n.getHeight(o)),r=e.get2dContext(a);return"v"==i?(r.scale(1,-1),r.drawImage(o,0,-a.height)):(r.scale(-1,1),r.drawImage(o,-a.width,0)),c(o),t.canvasToBlob(a)})}function a(n,o,i,a,r){return t.blobToImage(n).then(function(n){var u=e.create(a,r),l=e.get2dContext(u);return l.drawImage(n,-o,-i),c(n),t.canvasToBlob(u)})}function r(n,o,i){return t.blobToImage(n).then(function(a){var r=e.create(o,i),u=e.get2dContext(r);return u.drawImage(a,0,0,o,i),c(a),t.canvasToBlob(r,n.type)})}var c=t.revokeImageUrl;return{rotate:o,flip:i,crop:a,resize:r}}),o("tinymce/imagetoolsplugin/CropRect",["tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Observable"],function(t,e,n,o,i){var a=0;return function(r,c,u,l){function s(t,e){return{x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}}function d(t,e){return{x:e.x-t.x,y:e.y-t.y,w:e.w,h:e.h}}function m(){return d(u,r)}function g(){function i(t){var o;return new e(M,{document:l.ownerDocument,handle:M+"-"+t.name,start:function(){o=r},drag:function(e){var i,a,c,l,s;i=o.x,a=o.y,c=o.w,l=o.h,i+=e.deltaX*t.deltaX,a+=e.deltaY*t.deltaY,c+=e.deltaX*t.deltaW,l+=e.deltaY*t.deltaH,20>c&&(c=20),20>l&&(l=20),s=r=n.clamp({x:i,y:a,w:c,h:l},u,"move"==t.name),s=d(u,s),x.fire("updateRect",{rect:s}),v(s)}})}t('<div id="'+M+'" class="'+C+'croprect-container" data-mce-bogus="all">').appendTo(l),o.each(R,function(e){t("#"+M,l).append('<div id="'+M+"-"+e+'"class="'+C+'croprect-block" style="display: none" data-mce-bogus="all">')}),o.each(k,function(e){t("#"+M,l).append('<div id="'+M+"-"+e.name+'" class="'+C+"croprect-handle "+C+"croprect-handle-"+e.name+'" style="display: none" data-mce-bogus="all">')}),I=o.map(k,i),h(r)}function f(e){var n;n=o.map(k,function(t){return"#"+M+"-"+t.name}).concat(o.map(R,function(t){return"#"+M+"-"+t})).join(","),e?t(n,l).show():t(n,l).hide()}function h(e){function n(e,n){n.h<0&&(n.h=0),n.w<0&&(n.w=0),t("#"+M+"-"+e,l).css({left:n.x,top:n.y,width:n.w,height:n.h})}o.each(k,function(n){t("#"+M+"-"+n.name,l).css({left:e.w*n.xMul+e.x,top:e.h*n.yMul+e.y})}),n("top",{x:c.x,y:c.y,w:c.w,h:e.y-c.y}),n("right",{x:e.x+e.w,y:e.y,w:c.w-e.x-e.w+c.x,h:e.h}),n("bottom",{x:c.x,y:e.y+e.h,w:c.w,h:c.h-e.y-e.h+c.y}),n("left",{x:c.x,y:e.y,w:e.x-c.x,h:e.h}),n("move",e)}function p(t){r=t,h(r)}function y(t){c=t,h(r)}function v(t){p(s(u,t))}function b(t){u=t,h(r)}function w(){o.each(I,function(t){t.destroy()}),I=[]}var x,k,I,R,C="mce-",M=C+"crid-"+a++;return k=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}],R=["top","right","bottom","left"],g(l),x=o.extend({toggleVisibility:f,setClampRect:b,setRect:p,getInnerRect:m,setInnerRect:v,setViewPortRect:y,destroy:w},i)}}),o("tinymce/imagetoolsplugin/ImagePanel",["tinymce/ui/Control","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Promise","tinymce/imagetoolsplugin/CropRect"],function(t,e,n,o,i,a){function r(t){return new i(function(e){function n(){t.removeEventListener("load",n),e(t)}t.complete?e(t):t.addEventListener("load",n)})}return t.extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(t){var e=this,o=new Image;o.src=t,r(o).then(function(){var t,i,a=e.state.get("viewRect");i=e.$el.find("img"),i[0]?i.replaceWith(o):e.getEl().appendChild(o),t={x:0,y:0,w:o.naturalWidth,h:o.naturalHeight},e.state.set("viewRect",t),e.state.set("rect",n.inflate(t,-20,-20)),a&&a.w==t.w&&a.h==t.h||e.zoomFit(),e.repaintImage(),e.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,e,n,o,i,a,r,c=this;r=10,t=c.$el.find("img"),e=c.getEl().clientWidth,n=c.getEl().clientHeight,o=t[0].naturalWidth,i=t[0].naturalHeight,a=Math.min((e-r)/o,(n-r)/i),a>=1&&(a=1),c.zoom(a)},repaintImage:function(){var t,e,n,o,i,a,r,c,u,l;l=this.getEl(),c=this.zoom(),u=this.state.get("rect"),r=this.$el.find("img"),i=l.offsetWidth,a=l.offsetHeight,n=r[0].naturalWidth*c,o=r[0].naturalHeight*c,t=Math.max(0,i/2-n/2),e=Math.max(0,a/2-o/2),r.css({left:t,top:e,width:n,height:o}),this.cropRect&&(this.cropRect.setRect({x:u.x*c+t,y:u.y*c+e,w:u.w*c,h:u.h*c}),this.cropRect.setClampRect({x:t,y:e,w:n,h:o}),this.cropRect.setViewPortRect({x:0,y:0,w:i,h:a}))},bindStates:function(){function t(t){e.cropRect=new a(t,e.state.get("viewRect"),e.state.get("viewRect"),e.getEl()),e.cropRect.on("updateRect",function(t){var n=t.rect,o=e.zoom();n={x:Math.round(n.x/o),y:Math.round(n.y/o),w:Math.round(n.w/o),h:Math.round(n.h/o)},e.state.set("rect",n)}),e.on("remove",e.cropRect.destroy)}var e=this;e.state.on("change:cropEnabled",function(t){e.cropRect.toggleVisibility(t.value),e.repaintImage()}),e.state.on("change:zoom",function(){e.repaintImage()}),e.state.on("change:rect",function(n){var o=n.value;e.cropRect||t(o),e.cropRect.setRect(o)})}})}),o("tinymce/imagetoolsplugin/ColorMatrix",[],function(){function t(t,e,n){return t=parseFloat(t),t>n?t=n:e>t&&(t=e),t}function e(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function n(t,e){var n,o,i,a,r=[],c=new Array(10);for(n=0;5>n;n++){for(o=0;5>o;o++)r[o]=e[o+5*n];for(o=0;5>o;o++){for(a=0,i=0;5>i;i++)a+=t[o+5*i]*r[i];c[o+5*n]=a}}return c}function o(e,n){return n=t(n,0,1),e.map(function(e,o){return o%6===0?e=1-(1-e)*n:e*=n,t(e,0,1)})}function i(e,o){var i;return o=t(o,-1,1),o*=100,0>o?i=127+o/100*127:(i=o%1,i=0===i?d[o]:d[Math.floor(o)]*(1-i)+d[Math.floor(o)+1]*i,i=127*i+127),n(e,[i/127,0,0,0,.5*(127-i),0,i/127,0,0,.5*(127-i),0,0,i/127,0,.5*(127-i),0,0,0,1,0,0,0,0,0,1])}function a(e,o){var i,a,r,c;return o=t(o,-1,1),i=1+(o>0?3*o:o),a=.3086,r=.6094,c=.082,n(e,[a*(1-i)+i,r*(1-i),c*(1-i),0,0,a*(1-i),r*(1-i)+i,c*(1-i),0,0,a*(1-i),r*(1-i),c*(1-i)+i,0,0,0,0,0,1,0,0,0,0,0,1])}function r(e,o){var i,a,r,c,u;return o=t(o,-180,180)/180*Math.PI,i=Math.cos(o),a=Math.sin(o),r=.213,c=.715,u=.072,n(e,[r+i*(1-r)+a*-r,c+i*-c+a*-c,u+i*-u+a*(1-u),0,0,r+i*-r+.143*a,c+i*(1-c)+.14*a,u+i*-u+a*-.283,0,0,r+i*-r+a*-(1-r),c+i*-c+a*c,u+i*(1-u)+a*u,0,0,0,0,0,1,0,0,0,0,0,1])}function c(e,o){return o=t(255*o,-255,255),n(e,[1,0,0,0,o,0,1,0,0,o,0,0,1,0,o,0,0,0,1,0,0,0,0,0,1])}function u(e,o,i,a){return o=t(o,0,2),i=t(i,0,2),a=t(a,0,2),n(e,[o,0,0,0,0,0,i,0,0,0,0,0,a,0,0,0,0,0,1,0,0,0,0,0,1])}function l(e,i){return i=t(i,0,1),n(e,o([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],i))}function s(e,i){return i=t(i,0,1),n(e,o([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],i))}var d=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:e,adjust:o,multiply:n,adjustContrast:i,adjustBrightness:c,adjustSaturation:a,adjustHue:r,adjustColors:u,adjustSepia:l,adjustGrayscale:s}}),o("tinymce/imagetoolsplugin/Filters",["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ColorMatrix"],function(t,e,n,o){function i(o,i){return n.blobToImage(o).then(function(o){function a(t,e){var n,o,i,a,r,c=t.data,u=e[0],l=e[1],s=e[2],d=e[3],m=e[4],g=e[5],f=e[6],h=e[7],p=e[8],y=e[9],v=e[10],b=e[11],w=e[12],x=e[13],k=e[14],I=e[15],R=e[16],C=e[17],M=e[18],T=e[19];for(r=0;r<c.length;r+=4)n=c[r],o=c[r+1],i=c[r+2],a=c[r+3],c[r]=n*u+o*l+i*s+a*d+m,c[r+1]=n*g+o*f+i*h+a*p+y,c[r+2]=n*v+o*b+i*w+a*x+k,c[r+3]=n*I+o*R+i*C+a*M+T;return t}var r,c=t.create(e.getWidth(o),e.getHeight(o)),u=t.get2dContext(c);return u.drawImage(o,0,0),s(o),r=a(u.getImageData(0,0,c.width,c.height),i),u.putImageData(r,0,0),n.canvasToBlob(c)})}function a(o,i){return n.blobToImage(o).then(function(o){function a(t,e,n){function o(t,e,n){return t>n?t=n:e>t&&(t=e),t}var i,a,r,c,u,l,s,d,m,g,f,h,p,y,v,b,w;for(r=Math.round(Math.sqrt(n.length)),c=Math.floor(r/2),i=t.data,a=e.data,b=t.width,w=t.height,l=0;w>l;l++)for(u=0;b>u;u++){for(s=d=m=0,f=0;r>f;f++)for(g=0;r>g;g++)h=o(u+g-c,0,b-1),p=o(l+f-c,0,w-1),y=4*(p*b+h),v=n[f*r+g],s+=i[y]*v,d+=i[y+1]*v,m+=i[y+2]*v;y=4*(l*b+u),a[y]=o(s,0,255),a[y+1]=o(d,0,255),a[y+2]=o(m,0,255)}return e}var r,c,u=t.create(e.getWidth(o),e.getHeight(o)),l=t.get2dContext(u);return l.drawImage(o,0,0),s(o),r=l.getImageData(0,0,u.width,u.height),c=l.getImageData(0,0,u.width,u.height),c=a(r,c,i),l.putImageData(c,0,0),n.canvasToBlob(u)})}function r(o){return function(i,a){return n.blobToImage(i).then(function(i){function r(t,e){var n,o=t.data;for(n=0;n<o.length;n+=4)o[n]=e[o[n]],o[n+1]=e[o[n+1]],o[n+2]=e[o[n+2]];return t}var c,u,l=t.create(e.getWidth(i),e.getHeight(i)),d=t.get2dContext(l),m=new Array(256);for(u=0;u<m.length;u++)m[u]=o(u,a);return d.drawImage(i,0,0),s(i),c=r(d.getImageData(0,0,l.width,l.height),m),d.putImageData(c,0,0),n.canvasToBlob(l)})}}function c(t){return function(e,n){return i(e,t(o.identity(),n))}}function u(t){return function(e){return i(e,t)}}function l(t){return function(e){return a(e,t)}}var s=n.revokeImageUrl;return{invert:u([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:c(o.adjustBrightness),hue:c(o.adjustHue),saturate:c(o.adjustSaturation),contrast:c(o.adjustContrast),grayscale:c(o.adjustGrayscale),sepia:c(o.adjustSepia),colorize:function(t,e,n,a){return i(t,o.adjustColors(o.identity(),e,n,a))},sharpen:l([0,-1,0,-1,5,-1,0,-1,0]),emboss:l([-2,-1,0,-1,1,1,0,1,2]),gamma:r(function(t,e){return 255*Math.pow(t/255,1-e)}),exposure:r(function(t,e){return 255*(1-Math.exp(-(t/255)*e))}),colorFilter:i,convoluteFilter:a}}),o("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){function t(t){var e;return e=a.splice(++r),a.push(t),{state:t,removed:e}}function e(){return o()?a[--r]:void 0}function n(){return i()?a[++r]:void 0}function o(){return r>0}function i(){return-1!=r&&r<a.length-1}var a=[],r=-1;return{data:a,add:t,undo:e,redo:n,canUndo:o,canRedo:i}}}),o("tinymce/imagetoolsplugin/Dialog",["tinymce/dom/DOMUtils","tinymce/util/Tools","tinymce/util/Promise","tinymce/ui/Factory","tinymce/ui/Form","tinymce/ui/Container","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/UndoStack"],function(t,e,n,o,i,a,r,c,u,l,s){function d(t){return{blob:t,url:URL.createObjectURL(t)}}function m(t){t&&URL.revokeObjectURL(t.blob)}function g(t){e.each(t,m)}function f(n,l,f){function h(t){var e,n,o,i;e=F.find("#w")[0],n=F.find("#h")[0],o=parseInt(e.value(),10),i=parseInt(n.value(),10),F.find("#constrain")[0].checked()&&ce&&ue&&o&&i&&("w"==t.control.settings.name?(i=Math.round(o*le),n.value(i)):(o=Math.round(i*se),e.value(o))),ce=o,ue=i}function p(t){return Math.round(100*t)+"%"}function y(){F.find("#undo").disabled(!de.canUndo()),F.find("#redo").disabled(!de.canRedo()),F.statusbar.find("#save").disabled(!de.canUndo())}function v(){F.find("#undo").disabled(!0),F.find("#redo").disabled(!0)}function b(t){t&&X.imageSrc(t.url)}function w(t){return function(){var n=e.filter(re,function(e){return e.settings.name!=t});e.each(n,function(t){t.hide()}),t.show()}}function x(t){P=d(t),b(P)}function k(t){n=d(t),b(n),g(de.add(n).removed),y()}function I(){var t=X.selection();c.crop(n.blob,t.x,t.y,t.w,t.h).then(function(t){k(t),M()})}function R(t){var e=[].slice.call(arguments,1);return function(){var o=P||n;t.apply(this,[o.blob].concat(e)).then(x)}}function C(t){var e=[].slice.call(arguments,1);return function(){t.apply(this,[n.blob].concat(e)).then(k)}}function M(){b(n),m(P),w(O)(),y()}function T(){P&&(k(P.blob),M())}function B(){var t=X.zoom();2>t&&(t+=.1),X.zoom(t)}function z(){var t=X.zoom();t>.1&&(t-=.1),X.zoom(t)}function U(){n=de.undo(),b(n),y()}function H(){n=de.redo(),b(n),y()}function j(){l(n.blob),F.close()}function S(t){return new i({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}function D(t,e){return S([{text:"Back",onclick:M},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){v(),e(n.blob).then(function(t){var e=d(t);b(e),m(P),P=e})})}function W(t,e,o,i,a){function r(t){e(n.blob,t).then(function(t){var e=d(t);b(e),m(P),P=e})}return S([{text:"Back",onclick:M},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){r(t.value)},minValue:i,maxValue:a,value:o,previewFilter:p},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){this.find("slider").value(o),v()})}function E(t,e){function o(){var t,o,i;t=F.find("#r")[0].value(),o=F.find("#g")[0].value(),i=F.find("#b")[0].value(),e(n.blob,t,o,i).then(function(t){var e=d(t);b(e),m(P),P=e})}return S([{text:"Back",onclick:M},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:p},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:p},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:p},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",function(){F.find("#r,#g,#b").value(1),v()})}function L(t){t.control.value()===!0&&(le=ue/ce,se=ce/ue)}var F,O,A,P,_,V,$,X,G,Y,q,K,Z,N,Q,J,te,ee,ne,oe,ie,ae,re,ce,ue,le,se,de=new s;_=S([{text:"Back",onclick:M},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:I}]).hide().on("show hide",function(t){X.toggleCropRect("show"==t.type)}).on("show",v),V=S([{text:"Back",onclick:M},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:h},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:h},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:L},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(t){var e=parseInt(F.find("#w").value(),10),n=parseInt(F.find("#h").value(),10);t.preventDefault(),C(c.resize,e,n)(),M()}).on("show",v),$=S([{text:"Back",onclick:M},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip H",onclick:R(c.flip,"h")},{icon:"flipv",tooltip:"Flip V",onclick:R(c.flip,"v")},{icon:"rotateleft",tooltip:"Rotate left",onclick:R(c.rotate,-90)},{icon:"rotateright",tooltip:"Rotate right",onclick:R(c.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:T}]).hide().on("show",v),q=D("Invert",u.invert),ne=D("Sharpen",u.sharpen),oe=D("Emboss",u.emboss),K=W("Brightness",u.brightness,0,-1,1),Z=W("Hue",u.hue,180,0,360),N=W("Saturate",u.saturate,0,-1,1),Q=W("Contrast",u.contrast,0,-1,1),J=W("Grayscale",u.grayscale,0,0,1),te=W("Sepia",u.sepia,0,0,1),ee=E("Colorize",u.colorize),ie=W("Gamma",u.gamma,0,-1,1),ae=W("Exposure",u.exposure,1,0,2),A=S([{text:"Back",onclick:M},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:w(Z)},{text:"saturate",icon:"saturate",onclick:w(N)},{text:"sepia",icon:"sepia",onclick:w(te)},{text:"emboss",icon:"emboss",onclick:w(oe)},{text:"exposure",icon:"exposure",onclick:w(ae)},{type:"spacer",flex:1}]).hide(),O=S([{tooltip:"Crop",icon:"crop",onclick:w(_)},{tooltip:"Resize",icon:"resize2",onclick:w(V)},{tooltip:"Orientation",icon:"orientation",onclick:w($)},{tooltip:"Brightness",icon:"sun",onclick:w(K)},{tooltip:"Sharpen",icon:"sharpen",onclick:w(ne)},{tooltip:"Contrast",icon:"contrast",onclick:w(Q)},{tooltip:"Color levels",icon:"drop",onclick:w(ee)},{tooltip:"Gamma",icon:"gamma",onclick:w(ie)},{tooltip:"Invert",icon:"invert",onclick:w(q)}]),X=new r({flex:1,imageSrc:n.url}),G=new a({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:U},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:H},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:B},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:z}]}),Y=new a({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[G,X]}),re=[O,_,V,$,A,q,K,Z,N,Q,J,te,ee,ne,oe,ie,ae],F=o.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(t.DOM.getViewPort().w,800),minHeight:Math.min(t.DOM.getViewPort().h,650),title:"Edit image",items:re.concat([Y]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:j},{text:"Cancel",onclick:"close"}]}),F.renderTo(document.body).reflow(),F.on("close",function(){f(),g(de.data),de=null,P=null}),de.add(n),y(),X.on("load",function(){ce=X.imageSize().w,ue=X.imageSize().h,le=ue/ce,se=ce/ue,F.find("#w").value(ce),F.find("#h").value(ue)})}function h(t){return new n(function(e,n){f(d(t),e,n)})}return{edit:h}}),o("tinymce/imagetoolsplugin/Plugin",["tinymce/PluginManager","tinymce/Env","tinymce/util/Promise","tinymce/util/URI","tinymce/util/Tools","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Dialog"],function(t,e,n,o,i,a,c,u){t.add("imagetools",function(t){function l(e){function n(t){return t.indexOf("px")==t.length-2}var o,i;return o=e.style.width,i=e.style.height,o||i?n(o)&&n(i)?{w:parseInt(o,10),h:parseInt(i,10)}:null:(o=t.$(e).attr("width"),i=t.$(e).attr("height"),o&&i?{w:parseInt(o,10),h:parseInt(i,10)}:null)}function s(e,n){var o,i;n&&(o=e.style.width,i=e.style.height,(o||i)&&t.$(e).css({width:n.w,height:n.h}).removeAttr("data-mce-style"),o=e.width,i=e.height,(o||i)&&t.$(e).attr({width:n.w,height:n.h}))}function d(t){return{w:t.naturalWidth,h:t.naturalHeight}}function m(){return t.selection.getNode()}function g(){return"imagetools"+T++}function f(e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new o(n).host===t.documentBaseURI.host}function h(e){return-1!==i.inArray(t.settings.imagetools_cors_hosts,new o(e.src).host)}function p(t){return new n(function(e){var n=new XMLHttpRequest;n.onload=function(){e(this.response)},n.open("GET",t,!0),n.responseType="blob",n.send()})}function y(e){var n=e.src;return h(e)?p(e.src):(f(e)||(e=new Image,n=t.settings.imagetools_proxy,e.src+=(-1===n.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src)),c.imageToBlob(e))}function v(){var e;return e=t.editorUpload.blobCache.getByUri(m().src),e?e:y(m()).then(function(e){return c.blobToBase64(e).then(function(n){var o=t.editorUpload.blobCache,i=o.create(g(),e,n);return o.add(i),i})})}function b(e){return c.blobToDataUri(e).then(function(n){var i,a,c,u,l;return l=m(),i=g(),c=t.editorUpload.blobCache,a=o.parseDataUri(n).data,u=c.create(i,e,a),c.add(u),t.undoManager.transact(function(){function e(){t.$(l).off("load",e),t.nodeChanged()}t.$(l).on("load",e),t.$(l).attr({src:r+"?rand="+Math.floor(999*Math.random()+100)}).removeAttr("data-mce-src")}),u})}function w(e){return function(){return t._scanForImages().then(v).then(e).then(b)}}function x(t){return function(){return w(function(e){var n=l(m());return n&&s(m(),{w:n.h,h:n.w}),a.rotate(e.blob(),t)})()}}function k(t){return function(){return w(function(e){return a.flip(e.blob(),t)})()}}function I(){var t=m(),e=d(t);t&&y(t).then(u.edit).then(function(o){return new n(function(n){c.blobToImage(o).then(function(i){var a=d(i);(e.w!=a.w||e.h!=a.h)&&l(t)&&s(t,a),URL.revokeObjectURL(i.src),n(o)})})}).then(b,function(){})}function R(){t.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:x(-90)}),t.addButton("rotateright",{title:"Rotate clockwise",onclick:x(90)}),t.addButton("flipv",{title:"Flip vertically",onclick:k("v")}),t.addButton("fliph",{title:"Flip horizontally",onclick:k("h")}),t.addButton("editimage",{title:"Edit image",onclick:I}),t.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function C(e){var n=t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])");return n&&(f(e)||h(e)||t.settings.imagetools_proxy)}function M(){var e=t.settings.imagetools_toolbar;e||(e="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),t.addContextToolbar(C,e)}var T=0;e.fileApi&&(R(),M())})}),a(["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/CropRect","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ColorMatrix","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/UndoStack","tinymce/imagetoolsplugin/Dialog","tinymce/imagetoolsplugin/Plugin"])}(this);